From 30fc8b8516adf2a888054657e9c811eafaba952a Mon Sep 17 00:00:00 2001
From: Khem Raj <raj.khem@gmail.com>
Date: Tue, 9 Aug 2022 12:25:22 -0700
Subject: [PATCH] monkey: Fix TLS detection testcase

Clang15 errors out on compiling the check and disables TLS

Fixes errors like

error: call to undeclared function '__tls_get_addr'; ISO C99 and later do not support implicit function declarations [-Wimplicit-function-declaration]
         __tls_get_addr(0);
         ^

Signed-off-by: Khem Raj <raj.khem@gmail.com>
---
Upstream-Status: Pending

 lib/monkey/CMakeLists.txt | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/lib/monkey/CMakeLists.txt b/lib/monkey/CMakeLists.txt
index 95d8cc1..b8f1de5 100644
--- a/lib/monkey/CMakeLists.txt
+++ b/lib/monkey/CMakeLists.txt
@@ -192,6 +192,8 @@ endif()
 # Use old Pthread TLS
 if(NOT MK_PTHREAD_TLS)
   check_c_source_compiles("
+     #include <sys/types.h>
+     extern void *__tls_get_addr(size_t *v);
      __thread int a;
      int main() {
          __tls_get_addr(0);
